% test_anova_nhp% choose one of the following models% Notice that for the 1 column effects, the interaction is significant% against h0, but not against the column showing the effect.  It is% significant against the column with no effect, which makes sense.% uncomment one of the follwingm11 = 10; m12 = 10; m21 = 10; m22 = 10	% no effect% m11 = 10; m12 = 12; m21 = 10; m22 = 12	% col 2 effect%  m11 = 12; m12 = 12; m21 = 10; m22 = 10	% col 1 effect m11 = 10; m12 = 8;  m21 = 9;  m22 = 9;	% interactionn = 20					% number of trials% t is random time uniform on 10..15% this is to simulate the situation where counts are derived from% trials with different length epochs.t11 = 10 + 5 * rand(n,1);x11 = [ones(n,2) poissrnd(m11 * t11)];t12 = 10 + 5 * rand(n,1);x12 = [ones(n,1) 2*ones(n,1) poissrnd(m12 * t12)];t21 = 10 + 5 * rand(n,1);x21 = [2*ones(n,1) ones(n,1) poissrnd(m21 * t21)];t22 = 10 + 5 * rand(n,1);x22 = [2*ones(n,1) 2*ones(n,1) poissrnd(m22 * t22)];% we can get the average rate back from counts and durationsr11 = sum(x11(:,3))/sum(t11)r12 = sum(x12(:,3))/sum(t12)r21 = sum(x21(:,3))/sum(t21)r22 = sum(x22(:,3))/sum(t22)L = r(:,1)==1;mc1e1 = r(L,3)subplot(2,2,1),hist(r(L,3))L = r(:,1)==2;mc1e2 =  r(L,3);mean([mc1e1 mc1e2])[h,p] = ttest2(mc1e1,mc1e2)L = r(:,2)==1;mc2e1 = r(L,3);L = r(:,2)==2;mc2e2 =  r(L,3);mean([mc2e1 mc2e2])[h,p] = ttest2(mc2e1,mc2e2)subplot(2,2,2),hist(r(L,3))hist(x11(:,3)./t11)hist(x12(:,3)./t12)% design matrix is xx = [x11;x12;x21;x22];t =  [t11;t12;t21;t22];% need rates for normal caser = x; r(:,3) = x(:,3)./t;h1 = [1 2]% [p,llik, df, ph1] = anova_nhp(x,t,h1) [pn,llikn, dfn, ph1n] = anova_nh(r,h1) [pn0,llikn0, dfn0, ph1n0] = anova_nh0(r,h1) %compare[p;pn;pn0][llik;llikn;llikn0][df;dfn;dfn0][ph1;ph1n;ph1n0]
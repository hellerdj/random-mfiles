function b = goodtrial(paranum,e0)%  b = goodtrial(paranum,e0)% returns 1 if the trial defined by a snippet of efile data, E0, is a good% trial.  Returns 0 if it is a bad trial.  E0 is an n by 2 matrix, of ecode% data.  The 2nd column is ignored and the first is a list of event codes.% Depending on the paranum, the routine applies whatever logic we specify% below to do the determination.% 7/13/97 mil found bug. sometimes a bad trial occurs in the 'between'% region when adding new trials.  We changed error to warning.  Hopefully% this will not cause problems.% 5/12/98 - fixed bug that made the routine crash when getsid returned an% empty. getsid has been rejiggered so that it returns a NaN instead of an% empty, and this routine now returns a bad trial when sid is a NaN.  - jpgglobalEcodeHdr;if paranum == 512  sid = getsid(paranum,e0) - 5000;  if isnan(sid), b = 0;         % there was no trial  elseif sum(isMember(e0(:,1), [NOCHCD WRONGCD])) > 0    % This may or may not be a bad trial.  We want to keep track    % of trials in which the monkey aborted after learning the rew size.        % broke fixation after reward cue but before FPOFF?        q = find( (e0(:,1) > 5700 & e0(:,1) < 5900)...	| (e0(:,1) > 6700 & e0(:,1) < 6900));    if any( (e0(:,1) > 5700 & e0(:,1) < 5900) | ...	  (e0(:,1) > 6700 & e0(:,1) < 6900))      % a color change occurred      if ~any(e0(:,1)==FPOFFCD)	% monkey broke fixation before fpoff	b = -1;				% code brfix after color	return;      elseif ~any(e0(:,1)==REWCD)	% monkey made it to fpoff, but failed to sac to target	b = -2;				% code for wrong choice	return;      end    else      % a wrongcd or nochcd was dropped but the screw up occurred before      % a color change      b = 0;      return;    end  else    % it had better be a good trial.  We'll double check    if sum(isMember(e0(:,1), [EYEHLDCD REWCD CORRECTCD]))~= 3      warning('goodtrial: wrong number of good ecodes') % changed from 'error' 7/13/97      b = 0;    else      % all is well      b = 1;				% return arg    end  end  elseif ismember(paranum, [602 502 522])    paranum;  e0;   sid = getsid(paranum,e0);   if isnan(sid), b = 0;                     % there *was* no trial   elseif (sid > 70) & (sid < 100)          % it's a discrim trial     % keep wrong, but not no choice or correction loop trials     if sum(isMember(e0(:,1), [NOCHCD LOOPCD])) > 0        b = 0;				% return argument     elseif sum(ismember(e0(:,1), [CORRECTCD WRONGCD])) > 0       % all is well, IF it's either correct or wrong       b = 1;				% return arg     else       b = 0;     end      elseif (sid <= 70)                    % not a discrim trial     if sum(ismember(e0(:,1), CORRECTCD)) > 0       % all is well if s/he got it correct..in testing learned that WRONGCD       % wasn't being dropped properly, so need to rely on CORRECTCD. 8/12/97-jdr       b = 1;                        % return arg     else       b = 0;     end            else       sid       error('goodtrial.m:  bad stim id number.')   end   else  error('goodtrial.m:  bad paradigm number')end
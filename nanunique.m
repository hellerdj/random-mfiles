function [b,ndx,pos] = nanunique(a,flag,suppressnan)%NANUNIQUE Set unique, with a single NaN value for all NaNs in a set.%   Identical in usage and arguments to the standard MatLab function%   unique(). Changes the NaNs to a random value, runs unique on a, and%   changes the random value back to NaN in b. %   Supersedes and replaces unique.m%%   The optional 3rd argument will suppress nans in B.  If b is a matrix,%   then only rows that contain all nans will be removed.%%   See also UNIQUE, UNION, INTERSECT, SETDIFF, SETXOR, ISMEMBER.% Jon Goldberg, 5/14/98 - based on mns' nanallequal.m% mns modified% get the unique nonNaN members of aaq = a(:);ua = unique(aq(finite(aq)));% pick a random value and make sure it is not already in arv = rand;while any(aq==rv)  rv = rand;end% switch the NaNs with the random valueatmp = a;atmp(isnan(a)) = rv;% call unique()if nargin>2  [b,ndx,pos]=unique(atmp,flag);else  [b,ndx,pos]=unique(atmp);end% switch the random value back to NaNb(find(b==rv))=NaN;if nargin>2  if suppressnan    if isvector(b)      b = b(finite(b));    else      % remove any rows of b that contain all nans      b(all(isnan(b),2),:) = [];    end  endend
function [pa, pb, na, nb] = p560pmf_nmf(fname, plotopt, plot0resp)% [pa, pb, na, nb] = p560pmf_nmf(fname, plotopt, plot0resp)%	Takes a 560 spikes file (e.g., fname = '/data/kono/good/k007') and%	computes the psychometric and neurometric functions, returning alpha%	and beta vals for each (pa,pb for psycho; na,nb for neuro).%	If plotopt = 1, the routine plots the functions in the current axes.%	If plot0resp = 1, the prob correct for 0% are place on the ordinate%	(0 is not on the abscissa of the log scale, of course).%% testing. comment out.%$$$ cd /home/monkeybiz/mike/mat/mfiles%$$$ fname = '/data/wacko/good/w183'%$$$ fname = '/data/eve/good/e030'%$$$ %$$$ %$$$ plotopt = 1%$$$  error('You forgot to comment out the testing lines')% fname = 'sp.tmp'%% The columns are: coh  dir  correct  spikestfn = tempname;s = sprintf('tail +2 %s > %s', fname, tfn);[status, a] = unix(s);if status ~= 0  error('560pmf_nmf: unable to open file');endfid = fopen(tfn,'r');x = fscanf(fid,'%d');fclose(fid);y = reshape(x,4,size(x,1)/4)';% correct any direction vals that are novar (dir = 2,3)L = y(:,2) == 2 | y(:,2) == 3;y(L,2) = y(L,2)-2; % remove the temporary files = sprintf('rm %s', tfn);unix(s);% x = [y y(:,3)==y(:,2)];z = combinedups(y,1);x0 = [z(:,1)/10 z(:,[3 5])];[pa,pb] = quickfit(x0);%  clear quickfit%%% na, nb   Neurometric functions% The columns of y are: coh  dir  cor  spikes% We need a new column, direction.% MNS 5/17/96.  I think I have a major error here.  I used this function to% calculate neurometric alpha and beta for Table 1 of SOC2 (actually I used% some 'constrained' version of quick fitting that I can't recall.  But it% looks like I sorted the data by the monkey's choice -- not by the stimulus% direction!  I am commenting out the bad lines and placeing a #t# next to% them, for the recordd = ~xor(y(:,2),y(:,3));% [y(:,[2 3]) d]p = zeros(size(x0(:,1)));for i = 1:size(x0,1)   L = y(:,1)/10 == x0(i,1);			% select by coh  % #t# L1 = L & d;  % #t# L0 = L & ~d;  L1 = L & y(:,2);  L0 = L & ~y(:,2);  p(i) = rocN(y(L1,4),y(L0,4),100);end%$$$ size(x0)%$$$ size(p')x1 = [x0(:,1), p, x0(:,3)];[na nb] = quickfit(x1)% clear quickfit% plottingif nargin > 1  if plotopt    if nargin < 3      plot0resp = 0;    end    cmin = .1    cla;     plot(x0(:,1), x0(:,2),'yo'); hold on; % psychometric data    plot(x1(:,1), x1(:,2),'c.','MarkerSize',18); 	% neurometric data    if plot0resp      plot(cmin,x0(1,2),'yo'); 		% 0% coh response      plot(cmin,x1(1,2),'c.','MarkerSize',18);    end    if x0(1,1) ~= 0			% if the lowest coh is not 0      xi = logspace(log10(x0(1,1)),2,100);    else      xi = logspace(log10(x0(2,1)),2,100);    end    yp = 1 - .5*exp(-((xi/pa).^pb));    yn = 1 - .5*exp(-((xi/na).^nb));    plot(xi, yp, 'y--');		% psychometric fit    plot(xi, yn, 'c-');			% neurometric fit    set(gca,'XScale','log','XLim',[cmin 100],'YLim',[.4 1]);    set(gca, 'Box', 'off', 'XTickLabels',['0.1'; ' 1 '; ' 10'; '100'],'FontSize',14)    txtx = text(1,0,'Motion strength (% coherence)')    set(gca,'XLabel', txtx)    set(txtx,'VerticalAlignment','top','FontSize',18)    txty = text(0,0,'Proportion correct');    set(gca,'YLabel',txty);    set(txty, 'FontSize', 18);  endend  
% fiddle with matrix concepts toward canonical correlation and generalized% multivariate regession.  MANCOVA% WOrking through Anderson.% p 285 eq 8(1)% I'm used to writing the solution as b = inv(Z'Z)*Z'*x% They write as a sum of outer products on the rows% In their notation, lowercase z is a column m-vector% So I have to reverse the transpose% Then, it's true that Z'Z = sum{i=1..n}[Z(i,:)'*Z(i,:)] % In words, Z'Z is the m x m matrix that is the sum of the row outer products. n = 6; m = 4Z = round(10* rand(n,m))x = round(10 * rand(n,1))xx = round(10 * rand(n,2))Z'*x(x'*Z)'s = zeros(size(Z'*x))for i = 1:n  s = s + (x(i)*Z(i,:))';endsz = zeros(m,m);for i = 1:n  z = z + Z(i,:)' * Z(i,:);endall(all(z==Z'*Z))% Using the usual notions of Z (the design matrix)A = (Z'*Z)'      % eq. 8all(all(A==A'))% xx is an N x m matrix of N m-tuplesC = (Z'*xx)'c = zeros(size(C))for i = 1:n  c = c + xx(i,:)'*Z(i,:)endall(all(C==c))% Here's the solutionB = C*inv(A)inv(a)help mvnrndS = qrancorrelmtx(2,.3,.3,1)mvnrnd([0 0],S,10)% Let's see if this works.  The rows of Btrue are the coords of the constant term% and the coefficients of the independent variableBtrue = [-5 10; 3 1]% The 1st row of Btrue is the generalized intercept: the expected vector when% the independent variable is 0int = [1 0] * Btrue% The 2nd row is the vector offset for a unit change in the independent variableuvect = [1 1]*Btrue - int% Here is a fake design matrix, Z.  The 1st column is the constant term.% The second column is cohindVar = [-5:5]'Z = [ones(size(indVar)) indVar]ytrue = Z*Btruey = Z*Btrue + mvnrnd([0 0],S,size(indVar,1))hold offplot(y(:,1),y(:,2),'bo')hold onplot(ytrue(:,1),ytrue(:,2),'ro')hold offplot3(indVar,y(:,1),y(:,2),'o')plot3(indVar,ytrue(:,1),ytrue(:,2),'o')Y = y;X = Z;B = mregress(Y,X)B = mregress(y,Z)% A = (Z'*Z)'      % eq. 8% C = (Z'*y)'% B = (C*inv(A))'yest = Z*Bhold offplot(y(:,1),y(:,2),'bo')hold onplot(ytrue(:,1),ytrue(:,2),'ro')plot(yest(:,1),yest(:,2),'k*')hold offB
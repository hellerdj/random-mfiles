function p = multivarnormpdf(x,u,C)% MULTIVARNORMPDF multivariate normal probability density function%   computes probability of obtaining the column vector X%   from the normal pdf with mean vector u and covariance matrix C%   If X is a matrix, then the routine returns a rowvector,p, for the%   probability of obtaining each of X's column vectors.  u must be a column%   vector.%% test data% $$$ s1 = 1; s2 = 2; u = [0 1]'; % $$$ r = .25% $$$ C = [s1^2 r*s1*s2; r*s1*s2 s2^2]% $$$ x = [[0 1]' [0 0]']% $$$ x = [x; x]% $$$ X = x'if size(u,2)~=1  error('u must be a column vector')endif size(u,1) ~= size(C,1)  error('u and C must have same length')endp = nans(1,size(x,2));			% allocate return vectorif size(x,1) ~= size(u,1)   error('multivarnormpdf.m: x must be a column vector or matrix whose 1st dimension matches C and u');endnfact = ((2*pi)^(-.5*length(u)) / sqrt(det(C)))Cinv = inv(C);for i = 1:size(x,2) p(i) = nfact * exp(-.5 * (x(:,i)- u)' * Cinv *  (x(:,i)-u))';end
function truefalse = nanallequal(x,y,dim)% NANALLEQUAL  checks to see if matrix x and y are identical.%   nanallequal(x,y) is equivalent to all(x==y), but tolerates the presence%   of NaN values.  The optional dimension argument is used just like in%   all.  This means that y can be a matrix (same size as x)  or a scalar.%   The operation is on columns, by default, but will respect the dimension%   argument. %% Here is the help from ALL%% $$$  ALL    True if all elements of a vector are nonzero.% $$$     For vectors, ALL(V) returns 1 if all of the elements of the% $$$     vector are non-zero. Otherwise it returns 0. For matrices,% $$$     ALL(X) operates on the columns of X, returning a row vector% $$$     of 1's and 0's. For N-D arrays, ALL(X) operates on the first% $$$     non-singleton dimension.% $$$  % $$$     ALL(X,DIM) works down the dimension DIM.  For example, ALL(X,1)% $$$     works down the first dimension (the rows) of X.if nargin < 3  dim = 1;end% get the unique nonNaN members of xxq = x(:);ux = unique(xq(finite(xq)));yq = y(:);uy = unique(yq(finite(yq)));% pick a random value and make sure it is not already in x or yrv = rand;while any(ux==rv) | any(uy==rv)  rv = rand;endx(isnan(x)) = rv;y(isnan(y)) = rv;truefalse = all(x==y,dim);